# AGENT INSTRUCTIONS

These rules are meant for GPT agents running as `GPT-5.1.Codex-Max`, `GPT-5.1.Codex`, or `GPT-5.1.Codex-Mini`. Apply them whenever you are editing this repository:

1. **Polars first, always.** Default to `polars` (Python) and `r-polars` (R) for tabular work. Avoid adding new `pandas`/`data.table`/`dplyr` paths; if you must use another engine (pandas, arrow, duckdb, fireducks, etc.), pick the best available method and clearly mark it with a `TODO(polars): convert` note so it is tracked for migration.
2. **Stay current on Polars.** Whenever you touch dependency manifests, lockfiles, or setup scripts, bump `polars` and `r-polars` to the latest stable release. Incorporate newly released Polars features where they simplify or enable migrations, and favor replacing hand-rolled utilities with built-ins when feasible.
3. **Progressive Polars migration.** In each workflow, look for small wins to move existing non-Polars code to Polars (vectorized ops, lazy queries, streaming, native JSON/SQL helpers, etc.). If full migration is out of scope, leave targeted TODOs describing the remaining steps so future passes can continue the conversion.
4. **FDA scraper parity and independence.** Keep `pipelines/drugs/scripts/` and `dependencies/fda_ph_scraper` in sync: mirror normalization/text-processing logic into `dependencies/fda_ph_scraper/text_utils.py`, keep `dependencies/fda_ph_scraper/requirements.txt` current, and ensure the scraper runs from its own root with outputs under `output/`.
5. **Standalone dependencies.** Treat `dependencies/fda_ph_scraper`, `dependencies/atcd`, and `dependencies/drugbank_generics` as fully standalone projects that may live outside `<esoa_root>/dependencies/`; avoid `esoa` root/sibling assumptions, declare dependencies locally, and default all scripts to writing under each project’s `output/` while downstream runners handle copying into `inputs/drugs/`.
6. **Commit & submodule workflow.** Before creating a commit, inspect every submodule (`git submodule status`) for unstaged changes. If a submodule changed, commit and push that submodule first using a concise message describing its diff, then update the main repository’s submodule pointer (commit and push that change separately). Always pull/push as appropriate within each repository before moving on so every agent run leaves the working tree clean.
