# AGENT INSTRUCTIONS

These rules are meant for GPT agents running as `gpt-X.x-codex-high` or `gpt-X.x-codex-mini-high`. Apply them whenever you are editing this repository:

1. **Polars first, always.** Default to `polars` (Python) and `r-polars` (R) for tabular work. Avoid adding new `pandas`/`data.table`/`dplyr` paths; if you must use another engine (pandas, arrow, duckdb, fireducks, etc.), pick the best available method and clearly mark it with a `TODO(polars): convert` note so it is tracked for migration.
2. **Stay current on Polars.** Whenever you touch dependency manifests, lockfiles, or setup scripts, bump `polars` and `r-polars` to the latest stable release. Incorporate newly released Polars features where they simplify or enable migrations, and favor replacing hand-rolled utilities with built-ins when feasible.
3. **Progressive Polars migration.** In each workflow, look for small wins to move existing non-Polars code to Polars (vectorized ops, lazy queries, streaming, native JSON/SQL helpers, etc.). If full migration is out of scope, leave targeted TODOs describing the remaining steps so future passes can continue the conversion.
4. **Keep the standalone FDA scraper dependency files aligned.** Whenever you touch `pipelines/drugs/scripts/` (especially the normalization helpers or third-party imports) make sure the counterpart `dependencies/fda_ph_scraper/text_utils.py` captures the same text-processing logic and the `dependencies/fda_ph_scraper/requirements.txt` lists the packages needed by those scripts so the standalone scraper runs with the same dependencies as the pipeline helpers.
5. **Standalone runner behavior.** The scripts under `dependencies/fda_ph_scraper`, `dependencies/atcd`, and `dependencies/drugbank_generics` must continue to be runnable on their own roots; they should default to writing outputs under their own `output/` directories while downstream runners copy those exports into `inputs/drugs/`.
6. **Commit & submodule workflow.** Before creating a commit, inspect every submodule (`git submodule status`) for unstaged changes. If a submodule changed, commit and push that submodule first using a concise message describing its diff, then update the main repositoryâ€™s submodule pointer (commit and push that change separately). Always pull/push as appropriate within each repository before moving on so every agent run leaves the working tree clean.
